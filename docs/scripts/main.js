"use strict";window.g_avH=class{constructor(e,a){this.g_avI=e,this.g_avJ=a,this.g_avK=!1,this.g_aeT=()=>this.g_Im()}g_avL(){}g_avM(e,a,g,_){this.g_avI.g_avN(this.g_avJ,e,a,!!g,_)}g_avO(e,a,g,_){return this.g_avI.g_avP(this.g_avJ,e,a,!!g,_)}g_avQ(e,a,g){this.g_avI.g_avR()?this.g_avM(e,a,g):this.g_avI.g_avS()._OnMessageFromDOM({type:"event",component:this.g_avJ,handler:e,dispatchRuntimeEvent:g,data:a,responseId:null})}g_avT(e,a){this.g_avI.g_avU(this.g_avJ,e,a)}g_avV(e){for(const[a,g]of e)this.g_avT(a,g)}g_avW(){return this.g_avI}g_avX(){return this.g_avJ}g_WT(){this.g_avK||(this.g_avI.g_avY(this.g_aeT),this.g_avK=!0)}g_WH(){this.g_avK&&(this.g_avI.g_avZ(this.g_aeT),this.g_avK=!1)}g_Im(){}},"use strict",window.g_av_=class extends g_avH{constructor(e,a){super(e,a),this.g_av$=new Map,this.g_awa=!0,this.g_avT("create",e=>this.g_awb(e)),this.g_avT("destroy",e=>this.g_awc(e)),this.g_avT("set-visible",e=>this.g_awd(e)),this.g_avT("update-position",e=>this.g_awe(e)),this.g_avT("update-state",e=>this.g_awf(e)),this.g_avT("focus",e=>this.g_awg(e)),this.g_avT("set-css-style",e=>this.g_awh(e))}g_awi(e){this.g_awa=!!e}g_awj(e,g){this.g_avT(e,e=>{const a=e.elementId,_=this.g_av$.get(a);return g(_,e)})}g_awb(e){const a=e.elementId,g=this.g_Xr(a,e);this.g_av$.set(a,g),this.g_awa&&document.body.appendChild(g)}g_Xr(){throw new Error("required override")}g_awk(){}g_awc(e){const a=e.elementId,g=this.g_av$.get(a);this.g_awk(g),this.g_awa&&g.parentElement.removeChild(g),this.g_av$.delete(a)}g_awl(e,a,g){g||(g={}),g.elementId=a,this.g_avM(e,g)}g_awm(e,a,g){g||(g={}),g.elementId=a,this.g_avQ(e,g)}g_awd(e){if(this.g_awa){const a=this.g_av$.get(e.elementId);a.style.display=e.isVisible?"":"none"}}g_awe(e){if(this.g_awa){const a=this.g_av$.get(e.elementId);a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.width+"px",a.style.height=e.height+"px";const g=e.fontSize;null!==g&&(a.style.fontSize=g+"em")}}g_awf(e){const a=this.g_av$.get(e.elementId);this.g_awn(a,e)}g_awn(){throw new Error("required override")}g_awg(e){const a=this.g_av$.get(e.elementId);e.focus?a.focus():a.blur()}g_awh(e){const a=this.g_av$.get(e.elementId);a.style[e.prop]=e.val}g_awo(e){return this.g_av$.get(e)}},"use strict";{function _(e){return new Promise((a,g)=>{const _=document.createElement("script");_.onload=a,_.onerror=g,_.async=!1,_.src=e,document.head.appendChild(_)})}function t(e){return new Promise((g,_)=>{const a=new FileReader;a.onload=e=>g(e.target.result),a.onerror=e=>_(e),a.readAsText(e)})}function r(e){return new Promise((g,_)=>{const a=new FileReader;a.onload=e=>g(e.target.result),a.onerror=e=>_(e),a.readAsArrayBuffer(e)})}function s(e){if(!e)return"";const a=e.split(".");if(2>a.length)return"";const g=a[a.length-1].toLowerCase();return p.get(g)||""}const a=/(iphone|ipod|ipad)/i.test(navigator.userAgent);let e=new Audio;const d={"audio/webm; codecs=opus":!!e.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!e.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!e.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!e.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!e.canPlayType("audio/mp4"),"audio/mpeg":!!e.canPlayType("audio/mpeg")};e=null;const g=[];let y=0;const i=Math.max(navigator.hardwareConcurrency||0,8),p=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"]]),u=[],l=new Map,m=new Map;let n=0;window.g_awp=class e{constructor(e){this.g_awq=e.g_awr,this.g_aws=null,this.g_adW="",this.g_awt={},this.g_awu=null,this.g_awv=null,this.g_aww=[],this.g_awx=null,this.g_abU=null,this.g_afD=null,this.g_acC=-1,this.g_awy=()=>this.g_awz(),this.g_awA=[],this.g_ad$=e.g_awB,this.g_awC=!1,"html5"===this.g_ad$&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"),this.g_avU("runtime","cordova-fetch-local-file",e=>this.g_awD(e)),this.g_avU("runtime","create-job-worker",e=>this.g_awE(e)),"cordova"===this.g_ad$?document.addEventListener("deviceready",()=>this.g_VL(e)):this.g_VL(e)}g_eJ(){this.g_awF(),this.g_aws&&(this.g_aws.onmessage=null,this.g_aws=null),this.g_awu&&(this.g_awu.terminate(),this.g_awu=null),this.g_awv&&(this.g_awv.g_eJ(),this.g_awv=null),this.g_abU&&(this.g_abU.parentElement.removeChild(this.g_abU),this.g_abU=null)}g_awG(){return this.g_abU}g_fA(){return this.g_adW}g_avR(){return this.g_awq}g_ahg(){return this.g_ad$}g_afV(){return"cordova"===this.g_ad$&&a}g_awH(){if(!this.g_afV())return!1;const e=window.devicePixelRatio,a=window.screen.width*e,g=window.screen.height*e;return 1125==a&&2436==g}async g_VL(e){if(e.g_awI)this.g_adW=e.g_awI;else{this.g_adW=location.origin+location.pathname;const e=this.g_adW.lastIndexOf("/");-1!==e&&(this.g_adW=this.g_adW.substr(0,e+1))}if(e.g_awJ)for(const[a,g]of Object.entries(e.g_awJ))this.g_awt[a]=URL.createObjectURL(g);const a=new MessageChannel;this.g_aws=a.port1,this.g_aws.onmessage=e=>this._OnMessageFromRuntime(e.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(e=>this.g_awK(e)),this.g_afD=new self.g_awL(this),await this.g_afD.g_$o(),this.g_awM(),"object"==typeof window.StatusBar&&window.StatusBar.hide(),await this.g_awN(),this.g_awq?await this.g_awO(e,a.port2):await this.g_awP(e,a.port2)}g_awQ(e){return this.g_awt.hasOwnProperty(e)?this.g_awt[e]:e}async g_awR(g,a,_){if(g.startsWith("blob:"))return new Worker(g,_);if(this.g_afV()){const a=await this.g_Ab("scripts/"+g);return new Worker(URL.createObjectURL(a),_)}const t=new URL(g,a),n=location.origin!==t.origin;if(n){const e=await fetch(t);if(!e.ok)throw new Error("failed to fetch worker script");const a=await e.blob();return new Worker(URL.createObjectURL(a),_)}return new Worker(t,_)}g_awM(){if(this.g_awH()){const e=window.innerWidth>window.innerHeight,a=document.documentElement.style,g=document.body.style;e?(g.height=a.height="375px",g.width=a.width="812px"):(g.width=a.width="375px",g.height=a.height="812px")}}g_awS(g){return{baseUrl:this.g_adW,windowInnerWidth:window.innerWidth,windowInnerHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio,isFullscreen:e.g_ade(),projectData:g.g_awT,previewImageBlobs:window.cr_previewImageBlobs,previewProjectFileBlobs:window.cr_previewProjectFileBlobs,shaders:self.C3_Shaders,exportType:g.g_awB,isDebug:-1<self.location.search.indexOf("debug"),ife:!!self.g_awU,jobScheduler:this.g_afD.g_awV(),supportedAudioFormats:d,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||"scripts/opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||"scripts/opus.wasm.wasm",isWKWebView:this.g_afV(),isFBInstantAvailable:"undefined"!=typeof self.FBInstant}}async g_awO(e,a){let g=e.g_awW;this.g_awt.hasOwnProperty("workerMain.js")&&(g=this.g_awt["workerMain.js"]),this.g_awu=await this.g_awR(g,this.g_adW,{name:"Runtime"}),this.g_abU=document.createElement("canvas"),this.g_abU.style.display="none";const _=this.g_abU.transferControlToOffscreen();document.body.appendChild(this.g_abU),this.g_awu.postMessage(Object.assign(this.g_awS(e),{type:"init-runtime",isInWorker:!0,messagePort:a,canvas:_,workerDependencyScripts:e.g_awX||[],engineScripts:e.g_awY}),[a,_,...this.g_afD.g_awZ()]),this.g_aww=u.map(e=>new e(this)),this.g_aw_()}async g_awP(a,g){this.g_abU=document.createElement("canvas"),this.g_abU.style.display="none",document.body.appendChild(this.g_abU),this.g_aww=u.map(e=>new e(this)),this.g_aw_();const t=a.g_awY.map(e=>new URL(e,this.g_adW).toString());await Promise.all(t.map(a=>_(a)));const n=Object.assign(this.g_awS(a),{isInWorker:!1,messagePort:g,canvas:this.g_abU});this.g_awv=self.C3_CreateRuntime(n),await self.C3_InitRuntime(this.g_awv,n)}async g_awE(){const e=await this.g_afD.g_aw$();return{outputPort:e,transferables:[e]}}g_avS(){if(this.g_awq)throw new Error("not available in worker mode");return this.g_awv}g_avN(g,a,_,t,n){this.g_aws.postMessage({type:"event",component:g,handler:a,dispatchRuntimeEvent:t,data:_,responseId:null},this.g_awC?void 0:n)}g_avP(_,a,t,i,r){const e=n++,o=new Promise((g,a)=>{m.set(e,{resolve:g,reject:a})});return this.g_aws.postMessage({type:"event",component:_,handler:a,dispatchRuntimeEvent:i,data:t,responseId:e},this.g_awC?void 0:r),o}["_OnMessageFromRuntime"](e){const a=e.type;if("event"===a)this.g_axa(e);else if("result"===a)this.g_axb(e);else if("runtime-ready"===a)this.g_axc();else throw new Error(`unknown message '${a}'`)}g_axa(_){const t=_.component,n=_.handler,a=_.data,i=_.responseId,e=l.get(t);if(!e)return void console.warn(`[DOM] No event handlers for component '${t}'`);const r=e.get(n);if(!r)return void console.warn(`[DOM] No handler '${n}' for component '${t}'`);let g=null;try{g=r(a)}catch(e){return console.error(`Exception in '${t}' handler '${n}':`,e),void(null!==i&&this.g_axd(i,!1,e.toString()))}null!==i&&(g&&g.then?g.then(e=>this.g_axd(i,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${n}':`,e),this.g_axd(i,!1,e.toString())}):this.g_axd(i,!0,g))}g_axd(e,a,g){let _;g&&g.transferables&&(_=g.transferables),this.g_aws.postMessage({type:"result",responseId:e,isOk:a,result:g},_)}g_axb(g){const a=g.responseId,_=g.isOk,t=g.result,n=m.get(a);_?n.resolve(t):n.reject(t),m.delete(a)}g_avU(e,a,g){let _=l.get(e);if(_||(_=new Map,l.set(e,_)),_.has(a))throw new Error(`[DOM] Component '${e}' already has handler '${a}'`);_.set(a,g)}static g_axe(e){if(u.includes(e))throw new Error("DOM handler already added");u.push(e)}g_aw_(){for(const e of this.g_aww)if("runtime"===e.g_avX())return void(this.g_awx=e);throw new Error("cannot find runtime DOM handler")}g_awK(e){this.g_avN("debugger","message",e)}g_axc(){for(const e of this.g_aww)e.g_avL()}static g_ade(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}g_avY(e){this.g_awA.push(e),this.g_axf()}g_avZ(e){const a=this.g_awA.indexOf(e);if(-1===a)throw new Error("invalid callback");this.g_awA.splice(a,1),this.g_awA.length||this.g_awF()}g_axf(){-1===this.g_acC&&this.g_awA.length&&(this.g_acC=requestAnimationFrame(this.g_awy))}g_awF(){-1!==this.g_acC&&(cancelAnimationFrame(this.g_acC),this.g_acC=-1)}g_awz(){this.g_acC=-1;for(const e of this.g_awA)e();this.g_axf()}g_axg(e){this.g_awx.g_axg(e)}g_axh(e){this.g_awx.g_axh(e)}g_axi(){this.g_awx.g_axi()}g_axj(e){this.g_awx.g_axj(e)}g_AC(e){return!!d[e]}async g_afG(e){const a=await this.g_avP("runtime","opus-decode",{arrayBuffer:e},!1,[e]);return new Float32Array(a)}g_gl(e){return /^(?:[a-z]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)}g_gm(e){return!this.g_gl(e)}async g_awD(e){const a=e.filename;switch(e.as){case"text":return await this.g_Af(a);case"blob":return await this.g_Ab(a);case"blob-url":return await this.g_axk(a);case"buffer":return await this.g_Ah(a);default:throw new Error("unsupported type");}}g_axl(e){const g=window.cordova.file.applicationDirectory+"www/"+e;return new Promise((e,a)=>{window.resolveLocalFileSystemURL(g,g=>{g.file(e,a)},a)})}async g_Af(e){const a=await this.g_axl(e);return await t(a)}g_axm(){if(g.length&&!(y>=i)){y++;const e=g.shift();this.g_axn(e.filename,e.g_axo,e.g_axp)}}g_Ah(e){return new Promise((_,t)=>{g.push({filename:e,g_axo:e=>{y--,this.g_axm(),_(e)},g_axp:e=>{y--,this.g_axm(),t(e)}}),this.g_axm()})}async g_axn(g,a,e){try{const _=await this.g_axl(g),t=await r(_);a(t)}catch(g){e(g)}}async g_Ab(e,a){a||(a=s(e));const g=await this.g_Ah(e);return new Blob([g],{type:a})}async g_axk(e){const a=await this.g_Ab(e);return URL.createObjectURL(a)}g_awN(){let e=null;const g=new Promise(a=>e=a),_=new ArrayBuffer(1),t=new MessageChannel;return t.port2.onmessage=a=>{a.data&&a.data.arrayBuffer||(this.g_awC=!0,console.warn("MessageChannel transfers determined to be broken. Disabling transferables.")),e()},t.port1.postMessage({arrayBuffer:_},[_]),g}}}{function g(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents||e.originalEvent&&e.originalEvent.sourceCapabilities&&e.originalEvent.sourceCapabilities.firesTouchEvents}function a(e){return new Promise((a,g)=>{const _=new Image;_.onload=()=>a(_),_.onerror=e=>g(e),_.src=e})}async function _(e){const g=URL.createObjectURL(e);try{return await a(g)}finally{URL.revokeObjectURL(g)}}function t(){return window.parent&&window.parent.document.hasFocus()}self.C3_RasterSvgImage=async function(g,a,_){const t=document.createElement("canvas");t.width=a,t.height=_;const n=t.getContext("2d");return n.drawImage(g,0,0,a,_),t};let n=!1;document.addEventListener("pause",()=>n=!0),document.addEventListener("resume",()=>n=!1);const e=class extends g_avH{constructor(e){super(e,"runtime"),this.g_axq=!0,this.g_axr="any",this.g_axs=null,e.g_avU("canvas","update-size",e=>this.g_axt(e)),e.g_avU("runtime","invoke-download",e=>this.g_axu(e)),e.g_avU("runtime","raster-svg-image",e=>this.g_axv(e)),e.g_avU("runtime","set-target-orientation",e=>this.g_axw(e)),e.g_avU("runtime","register-sw",()=>this.g_axx()),e.g_avU("runtime","post-to-debugger",e=>this.g_axy(e)),e.g_avU("runtime","before-start-ticking",()=>this.g_axz()),e.g_avU("runtime","debug-highlight",e=>this.g_axA(e));const a=e.g_awG();a.addEventListener("contextmenu",e=>e.preventDefault()),a.addEventListener("selectstart",e=>e.preventDefault()),a.addEventListener("gesturehold",e=>e.preventDefault()),a.addEventListener("touchstart",e=>e.preventDefault()),window.addEventListener("mousedown",e=>{1===e.button&&e.preventDefault()}),window.addEventListener("resize",()=>this.g_acT()),this.g_axB=new Set,this.g_axC=new WeakSet,this.g_axD=!1}g_axz(){return window.addEventListener("visibilitychange",()=>this.g_afF(document.hidden)),document.addEventListener("pause",()=>this.g_afF(!0)),document.addEventListener("resume",()=>this.g_afF(!1)),{isSuspended:!!(document.hidden||n)}}g_avL(){window.addEventListener("focus",()=>this.g_axE("window-focus")),window.addEventListener("blur",()=>this.g_axE("window-blur",{parentHasFocus:t()})),window.addEventListener("fullscreenchange",()=>this.g_acU()),window.addEventListener("webkitfullscreenchange",()=>this.g_acU()),window.addEventListener("mozfullscreenchange",()=>this.g_acU()),window.addEventListener("fullscreenerror",e=>this.g_acV(e)),window.addEventListener("webkitfullscreenerror",e=>this.g_acV(e)),window.addEventListener("mozfullscreenerror",e=>this.g_acV(e)),window.addEventListener("keydown",e=>this.g_axF("keydown",e)),window.addEventListener("keyup",e=>this.g_axF("keyup",e)),window.addEventListener("mousemove",e=>this.g_axG("mousemove",e)),window.addEventListener("mousedown",e=>this.g_axG("mousedown",e)),window.addEventListener("mouseup",e=>this.g_axG("mouseup",e)),window.addEventListener("dblclick",e=>this.g_axG("dblclick",e)),window.addEventListener("wheel",e=>this.g_axH("wheel",e)),"undefined"==typeof g_axI?(window.addEventListener("touchstart",e=>this.g_axJ("pointerdown",e)),window.addEventListener("touchmove",e=>this.g_axJ("pointermove",e)),window.addEventListener("touchend",e=>this.g_axJ("pointerup",e)),window.addEventListener("touchcancel",e=>this.g_axJ("pointercancel",e))):(window.addEventListener("pointerdown",e=>this.g_axK("pointerdown",e)),window.addEventListener("pointermove",e=>this.g_axK("pointermove",e)),window.addEventListener("pointerup",e=>this.g_axK("pointerup",e)),window.addEventListener("pointercancel",e=>this.g_axK("pointercancel",e))),window.addEventListener("deviceorientation",e=>this.g_axL(e)),window.addEventListener("devicemotion",e=>this.g_axM(e));const e=()=>this.g_axi();window.addEventListener("pointerup",e,!0),window.addEventListener("touchend",e,!0),window.addEventListener("click",e,!0),window.addEventListener("keydown",e,!0),window.addEventListener("gamepadconnected",e,!0)}g_axE(e,a){this.g_avM(e,a||null,!0)}g_acT(){this.g_avM("window-resize",{innerWidth:window.innerWidth,innerHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio},!0)}g_axw(e){this.g_axr=e.targetOrientation}g_axN(){const e=this.g_axr;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(e).catch(e=>console.warn("[Construct 3] Failed to lock orientation: ",e));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(e):screen.webkitLockOrientation?a=screen.webkitLockOrientation(e):screen.mozLockOrientation?a=screen.mozLockOrientation(e):screen.msLockOrientation&&(a=screen.msLockOrientation(e)),a||console.warn("[Construct 3] Failed to lock orientation")}catch(e){console.warn("[Construct 3] Failed to lock orientation: ",e)}}g_acU(){const e=g_awp.g_ade();e&&"any"!==this.g_axr&&this.g_axN(),this.g_avM("fullscreenchange",{isFullscreen:e,innerWidth:window.innerWidth,innerHeight:window.innerHeight})}g_acV(e){console.warn("[Construct 3] Fullscreen request failed: ",e),this.g_avM("fullscreenerror",{isFullscreen:g_awp.g_ade(),innerWidth:window.innerWidth,innerHeight:window.innerHeight})}g_afF(e){e?this.g_avI.g_awF():this.g_avI.g_axf(),this.g_avM("visibilitychange",{hidden:e})}g_axF(e,a){this.g_avQ(e,{code:a.code,key:a.key,which:a.which,repeat:a.repeat,altKey:a.altKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey,shiftKey:a.shiftKey,timeStamp:a.timeStamp},!0)}g_axG(a,e){g(e)||("mousedown"===a&&window!==window.top&&window.focus(),this.g_avQ(a,{button:e.button,clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp},!0))}g_axH(e,a){this.g_avM(e,{clientX:a.clientX,clientY:a.clientY,deltaX:a.deltaX,deltaY:a.deltaY,deltaZ:a.deltaZ,deltaMode:a.deltaMode,timeStamp:a.timeStamp},!0)}g_axK(e,a){"pointerdown"===e&&window!==window.top&&window.focus(),this.g_avQ(e,{pointerId:a.pointerId,pointerType:a.pointerType,clientX:a.clientX,clientY:a.clientY,width:a.width||0,height:a.height||0,pressure:a.pressure||0,tangentialPressure:a.tangentialPressure||0,tiltX:a.tiltX||0,tiltY:a.tiltY||0,twist:a.twist||0,timeStamp:a.timeStamp},!0)}g_axJ(e,a){"pointerdown"===e&&window!==window.top&&window.focus();for(let g=0,_=a.changedTouches.length;g<_;++g){const _=a.changedTouches[g];this.g_avQ(e,{pointerId:_.identifier,pointerType:"touch",clientX:_.clientX,clientY:_.clientY,width:2*(_.radiusX||_.webkitRadiusX||_.mozRadiusX||_.msRadiusX||0),height:2*(_.radiusY||_.webkitRadiusY||_.mozRadiusY||_.msRadiusY||0),pressure:_.force||_.webkitForce||_.mozForce||_.msForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:_.rotationAngle||0,timeStamp:a.timeStamp},!0)}}g_axL(e){this.g_avM("deviceorientation",{alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0,timeStamp:e.timeStamp},!0)}g_axM(_){let a=0,t=0,n=0,r=0,o=0,s=0;const l=_.accelerationIncludingGravity;l&&(a=l.x||0,t=l.y||0,n=l.z||0);const y=_.acceleration;y&&(r=y.x||0,o=y.y||0,s=y.z||0),this.g_avM("devicemotion",{acceleration:{x:r,y:o,z:s},accelerationWithG:{x:a,y:t,z:n},timeStamp:_.timeStamp},!0)}g_axt(e){const a=this.g_avW(),g=a.g_awG();g.style.width=e.styleWidth+"px",g.style.height=e.styleHeight+"px",g.style.marginLeft=e.marginLeft+"px",g.style.marginTop=e.marginTop+"px",a.g_awM(),this.g_axq&&(g.style.display="",this.g_axq=!1)}g_axu(g){const _=g.url,t=g.filename,n=document.createElement("a"),e=document.body;n.textContent=t,n.href=_,n.download=t,e.appendChild(n),n.click(),e.removeChild(n)}async g_axv(t){const a=t.blob,n=t.width,i=t.height,e=await _(a),r=await self.C3_RasterSvgImage(e,n,i);return await createImageBitmap(r)}g_axi(){const e=[...this.g_axB];if(this.g_axB.clear(),!this.g_axD)for(const g of e){const e=g.play();e&&e.catch(()=>{this.g_axC.has(g)||this.g_axB.add(g)})}}g_axg(e){if("function"!=typeof e.play)throw new Error("missing play function");this.g_axC.delete(e);let a;try{a=e.play()}catch(a){return void this.g_axB.add(e)}a&&a.catch(()=>{this.g_axC.has(e)||this.g_axB.add(e)})}g_axh(e){this.g_axB.delete(e),this.g_axC.add(e)}g_axj(e){this.g_axD=!!e}g_axA(e){const a=e.show;if(!a)return void(this.g_axs&&(this.g_axs.style.display="none"));this.g_axs||(this.g_axs=document.createElement("div"),this.g_axs.id="inspectOutline",document.body.appendChild(this.g_axs));const g=this.g_axs;g.style.display="",g.style.left=e.left-1+"px",g.style.top=e.top-1+"px",g.style.width=e.width+2+"px",g.style.height=e.height+2+"px",g.textContent=e.name}g_axx(){window.C3_RegisterSW&&window.C3_RegisterSW()}g_axy(e){window.c3_postToMessagePort&&(e.from="runtime",window.c3_postToMessagePort(e))}};g_awp.g_axe(e)}{const e=document.currentScript.src;self.g_awL=class{constructor(a){this.g_axO=a,this.g_adW=e.substr(0,e.lastIndexOf("/")+1),this.g_ahM=Math.min(navigator.hardwareConcurrency||2,16),this.g_axP=null,this.g_axQ=[],this.g_ahK=null,this.g_axR=null}async g_$o(){if(this.g_axS)throw new Error("already initialised");this.g_axS=!0;const e=this.g_axO.g_awQ("dispatchWorker.js");this.g_axP=await this.g_axO.g_awR(e,this.g_adW,{name:"DispatchWorker"});const a=new MessageChannel;this.g_ahK=a.port1,this.g_axP.postMessage({type:"_init","in-port":a.port2},[a.port2]),this.g_axR=await this.g_aw$()}async g_aw$(){const g=this.g_axQ.length,a=this.g_axO.g_awQ("jobWorker.js"),_=await this.g_axO.g_awR(a,this.g_adW,{name:"JobWorker"+g}),t=new MessageChannel,n=new MessageChannel;return this.g_axP.postMessage({type:"_addJobWorker",port:t.port1},[t.port1]),_.postMessage({type:"init",number:g,"dispatch-port":t.port2,"output-port":n.port2},[t.port2,n.port2]),this.g_axQ.push(_),n.port1}g_awV(){return{inputPort:this.g_ahK,outputPort:this.g_axR,maxNumWorkers:this.g_ahM}}g_awZ(){return[this.g_ahK,this.g_axR]}}}if("use strict",window.C3_IsSupported){"undefined"!=typeof OffscreenCanvas;window.c3_runtimeInterface=new g_awp({g_awr:!1,g_awW:"workerMain.js",g_awY:["scripts/c3runtime.js"],g_awB:"html5"})}{const e=class extends g_avH{constructor(e){super(e,"mouse"),this.g_avT("cursor",e=>this.g_axT(e))}g_axT(e){document.body.style.cursor=e}};g_awp.g_axe(e)}{const e=class extends g_avH{constructor(e){super(e,"browser"),this.g_ad$="",this.g_avT("get-initial-state",e=>this.g_axU(e)),this.g_avT("ready-for-sw-messages",()=>this.g_axV()),this.g_avT("alert",e=>this.g_axW(e)),this.g_avT("close",()=>this.g_axX()),this.g_avT("set-focus",e=>this.g_awg(e)),this.g_avT("vibrate",e=>this.g_axY(e)),this.g_avT("lock-orientation",e=>this.g_axZ(e)),this.g_avT("unlock-orientation",()=>this.g_ax_()),this.g_avT("navigate",e=>this.g_ax$(e)),this.g_avT("request-fullscreen",()=>this.g_aya()),this.g_avT("exit-fullscreen",()=>this.g_ayb()),window.addEventListener("online",()=>this.g_aoD(!0)),window.addEventListener("offline",()=>this.g_aoD(!1)),document.addEventListener("backbutton",()=>this.g_ayc()),"undefined"!=typeof Windows&&Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",e=>this.g_ayd(e))}g_axU(e){return this.g_ad$=e.exportType,{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isScirraArcade:"undefined"!=typeof window.is_scirra_arcade}}g_axV(){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(e=>this.g_avM("sw-message",e.data))}g_aoD(e){this.g_avM("online-state",{isOnline:e})}g_ayc(){this.g_avM("backbutton")}g_ayd(e){e.handled=!0,this.g_avM("backbutton")}g_aye(){return"nwjs"===this.g_ad$?nw.Window.get():null}g_axW(e){alert(e.message)}g_axX(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}g_awg(e){const g=e.isFocus;if("nwjs"===this.g_ad$){const e=this.g_aye();g?e.focus():e.blur()}else g?window.focus():window.blur()}g_axY(e){navigator.vibrate&&navigator.vibrate(e.pattern)}g_axZ(e){const g=e.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(g).catch(e=>console.warn("[Construct 3] Failed to lock orientation: ",e));else try{let e=!1;screen.lockOrientation?e=screen.lockOrientation(g):screen.webkitLockOrientation?e=screen.webkitLockOrientation(g):screen.mozLockOrientation?e=screen.mozLockOrientation(g):screen.msLockOrientation&&(e=screen.msLockOrientation(g)),e||console.warn("[Construct 3] Failed to lock orientation")}catch(e){console.warn("[Construct 3] Failed to lock orientation: ",e)}}g_ax_(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(e){}}g_ax$(e){const a=e.type;if("back"===a)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.back();else if("forward"===a)window.forward();else if("home"===a)window.g_ayf();else if("reload"===a)location.reload();else if("url"===a){const a=e.url,g=e.target,_=e.exportType;"windows-uwp"===_&&"undefined"!=typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(a)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(a,{openExternal:!0}):"cordova"===_?window.open(a,"_system"):"preview"===_?window.open(a,"_blank"):!this.g_aoC&&(2===g?window.top.location=a:1===g?window.parent.location=a:window.location=a)}else if("new-window"===a){const a=e.url,g=e.tag,_=e.exportType;"windows-uwp"===_&&"undefined"!=typeof Windows?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(a)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(a,{openExternal:!0}):"cordova"===_?window.open(a,"_system"):window.open(a,g)}}g_aya(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen&&("undefined"==typeof Element.ALLOW_KEYBOARD_INPUT?e.webkitRequestFullScreen():e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT))}g_ayb(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}};g_awp.g_axe(e)}{function _(a){return a%=d,0>a&&(a+=d),a}function t(e,g,_){return e<g?g:e>_?_:e}function n(e,g,a){return e+a*(g-e)}function r(e,g,a){return e===g?0:(a-e)/(g-e)}function o(_,a){var t=Math.cos,n=Math.sin;if(_===a)return 0;const r=n(_),e=t(_),o=n(a),g=t(a),s=r*o+e*g;return 1<=s?0:-1>=s?Math.PI:Math.acos(s)}function e(_,a){var t=Math.cos,n=Math.sin;const i=n(_),e=t(_),r=n(a),g=t(a);return 0>=e*r-i*g}function s(t,n,a){const i=o(t,n);return e(n,t)?_(t+i*a):_(t-i*a)}const g=[],d=2*Math.PI;class y{constructor(g,a,_,t,n,e){this.g_BA=g,this.g_ayg=a,this.g_ayh=_,this.g_ayi=t,this.g_ayj=n,this.g_ayk=e}g_ayl(){return{tag:this.g_ayi,interp:this.g_ayg,userData:this.g_ayj,cvt:this.g_ayk}}g_CQ(){return this.g_BA}g_arX(){return this.g_ayg}g_aym(){return this.g_ayh}g_ayn(){return this.g_ayi}g_ayo(){return"undefined"!=typeof this.g_ayj}g_ayp(){return this.g_ayj}g_ayq(){return this.g_ayk}g_ayr(a){switch(this.g_ayh){case 0:return a;case 1:return Math.fround(a);case 2:return 2===this.g_ayg&&(a=_(a),a/=Math.PI,a-=1,a*=32767),t(0|a,-32768,32767);case 3:return 2===this.g_ayg&&(a=_(a),a/=d,a*=255),t(0|a,0,255);default:return a;}}g_ays(e,a,g){switch(this.g_ayh){case 0:e.setFloat64(a,g),a+=8;break;case 1:e.setFloat32(a,g),a+=4;break;case 2:e.setInt16(a,g),a+=2;break;case 3:e.setUint8(a,g),a+=1;break;default:e.setFloat32(a,g),a+=4;}return a}g_ayt(e){return 2===this.g_ayg?2===this.g_ayh?(e/=32767,e+=1,e*=Math.PI,e):3===this.g_ayh?(e/=255,e*=d,e):e:e}static g_ayu(g,a,_,t,e){return 0===g?e?_:a:1===g?n(a,_,t):2===g?s(a,_,t):e?_:a}}class i{constructor(e,a){this.timestamp=e,this.data=a}}class p{constructor(e,a,g){this.g_ayv=e,this.g_ayw=e.g_ayx(),this.g_aba=a,this.g_ayy=g,this._data=[],this._data.length=this.g_ayv.g_ayz().length,this.g_ayA=0,this.g_ayB=0,this.g_ayC=!1,this.g_ayD=!1,this.g_ayE=[],this.g_ayF=null,this.g_ayG=null,this.g_ayH=null}g_ayl(){const e=[];for(let a=0,g=this.g_ayv.g_ayz().length;a<g;++a)e.push(this.g_arX(this.g_ayv.g_ayI(),a));const a={id:this.g_aba,nid:this.g_ayy,isTimedOut:this.g_ayJ(),interpValues:e,latestUpdate:null},g=this.g_ayK();return g&&(a.latestUpdate={timestamp:g.timestamp,data:g.data}),a}g_ayL(){return this.g_aba}g_ayM(){return this.g_ayy}g_ayN(a){this.g_ayD=!!a}g_ayO(){return this.g_ayD}g_ayP(){return this.g_ayC}g_ayQ(_,t){const n=_.netValues,i=this.g_ayv.g_ayz(),a=i.length;this.g_ayC=!1;for(let g=0;g<a;++g){const _=i[g],a=_.g_ayr(n[g]);this._data[g]!==a&&(this._data[g]=a,this.g_ayA=t,this.g_ayv.g_ayR(t))}const e=t-this.g_ayA,r=t-this.g_ayB,g=this.g_ayv.g_ayS();this.g_ayC=!!(100>e&&0===g)||(1e3>e&&1>=g?95<=r:495<=r),this.g_ayC&&this.g_ayv.g_ayT()}g_ayU(g,a,e){const _=this.g_ayv.g_ayz();this.g_ayB=e,g.setUint16(a,this.g_ayy),a+=2;for(let t=0,n=this._data.length;t<n;++t)a=_[t].g_ays(g,a,this._data[t]);return a}g_ayV(e,a){for(let g=0,_=this.g_ayE.length;g<_;++g){const _=this.g_ayE[g];if(_.timestamp===e)return;if(_.timestamp>e)return void this.g_ayE.splice(g,0,new i(e,a))}this.g_ayE.push(new i(e,a))}g_ayJ(){return 0!==this.g_ayE.length&&this.g_ayE[this.g_ayE.length-1].timestamp<this.g_ayv.g_ayI()-3e3}g_Im(){for(;2<this.g_ayE.length&&this.g_ayE[0]!==this.g_ayF&&this.g_ayE[0]!==this.g_ayG&&this.g_ayE[0]!==this.g_ayH;)this.g_ayE.shift();const e=this.g_ayv.g_ayI();if(!(this.g_ayH&&this.g_ayH.timestamp>e&&this.g_ayG&&this.g_ayG.timestamp<e)){this.g_ayH=null;for(let a=0,g=this.g_ayE.length;a<g;++a){const g=this.g_ayE[a];if(g.timestamp<=e)(!this.g_ayG||g.timestamp>this.g_ayG.timestamp)&&(this.g_ayF=this.g_ayG,this.g_ayG=g);else{this.g_ayH=g;break}}}}g_ayK(){return 0===this.g_ayE.length?null:this.g_ayE[this.g_ayE.length-1]}g_arX(_,a,t){if(!this.g_ayH&&!this.g_ayG)return 0;if(this.g_ayH&&!this.g_ayG)return this.g_ayH.data[a];const n=this.g_ayv.g_ayz();let e,o,s,d,l;if(!this.g_ayH&&this.g_ayG){if(this.g_ayF&&!t){e=this.g_ayF.timestamp,o=this.g_ayF.data[a],s=this.g_ayG.timestamp,d=this.g_ayG.data[a];let g=_;return g>this.g_ayG.timestamp+this.g_ayv.g_ayW()&&(g=this.g_ayG.timestamp+this.g_ayv.g_ayW()),l=r(e,s,g),y.g_ayu(n[a].g_arX(),o,d,l,!0)}return this.g_ayG.data[a]}return e=this.g_ayG.timestamp,o=this.g_ayG.data[a],s=this.g_ayH.timestamp,d=this.g_ayH.data[a],l=r(e,s,_),y.g_ayu(n[a].g_arX(),o,d,l,!1)}}self.g_ayX=y,self.g_ayY=i,self.g_ayZ=class{constructor(e,a,g,_){switch(this.g_ayw=e,this.g_ay_=a,this.g_BB=g,this.g_ayy=this.g_ayw.g_ay$(),this.g_aza=_,this.g_ayj={},this.g_azb=0,this.g_azc=250,this.g_aza){case 1:this.g_azc=500;break;case 2:this.g_azc=2500;}this.g_azd=[],this.g_aze=[],this.g_azf=new Map,this.g_azg=new Set,this.g_azh=0,this.g_ayA=0,this.g_ayB=0,this.g_azi=0,this.g_azj=!1,this.g_azk=[],this.g_azl=new Map,this.g_azm=new Map,this.g_aqE=0,this.g_ayw.g_azn(this)}g_ayx(){return this.g_ayw}g_ayz(){return this.g_azd}g_azo(){return this.g_ay_}g_azp(e){this.g_ayy=e}g_ayM(){return this.g_ayy}g_ayR(e){this.g_ayA=e}g_ayS(){return this.g_aza}g_ayT(){this.g_azi++}g_azq(){return this.g_azi}g_ayI(){return this.g_aqE}g_azr(e){this.g_azj=!!e}g_azs(){return this.g_azj}g_ayW(){return this.g_azc}g_azt(){return this.g_BB}g_azu(){return this.g_azk}g_azv(g,a,_,t,n){const e=new y(this.g_azd.length,g,a,_,t,n);0===a?this.g_azb+=8:1===a?this.g_azb+=4:2===a?this.g_azb+=2:3===a?this.g_azb+=1:void 0,this.g_azd.push(e)}g_ayV(e,a,g){const _=this.g_azw(a);_.g_ayV(e,g)}g_Im(){this.g_aqE=this.g_ayw.g_azx();for(const e of this.g_aze)e.g_Im()}g_azy(){return this.g_aze.length}g_azz(e){return e=Math.floor(e),0>e||e>=this.g_aze.length?null:this.g_aze[e]}g_azA(e){for(const a of this.g_aze)if(a.g_ayM()===e)return a;return null}g_azB(){const e=[];for(const a of this.g_azd){const g={tag:a.g_ayn(),precision:a.g_aym(),interp:a.g_arX(),clientvaluetag:a.g_ayq()};a.g_ayo()&&(g.userdata=a.g_ayp()),e.push(g)}return e}g_azC(e){this.g_azd.length=0,this.g_azb=0;for(const a of e)this.g_azv(a.interp,a.precision,a.tag,a.userdata,a.clientvaluetag)}g_azw(e){let a=this.g_azm.get(e);return a?a:(a=new p(this,-1,e),this.g_azm.set(e,a),this.g_aze.push(a),a)}g_azD(e){let a=this.g_azf.get(e);return a?a:(a=new p(this,e,this.g_azE()),this.g_azf.set(e,a),this.g_aze.push(a),a)}g_azE(){do this.g_azh++,65535<this.g_azh&&(this.g_azh=0);while(this.g_azg.has(this.g_azh));const e=this.g_azh;return this.g_azg.add(e),e}g_azF(e){const a=e.g_ayL(),g=e.g_ayM();this.g_ayw.g_arf()&&!this.g_azj&&this.g_azk.push(g),this.g_azf.delete(a),this.g_azm.delete(g),this.g_azg.delete(g);const _=this.g_aze.indexOf(e);-1<_&&this.g_aze.splice(_,1)}g_ayQ(_,a){this.g_azi=0;for(const e of this.g_aze)e.g_ayN(!1);for(let g=0,e=_.length;g<e;++g){const t=_[g],e=t.uid,n=this.g_azD(e);n.g_ayN(!0),n.g_ayQ(t,a)}for(const e of this.g_aze)e.g_ayO()||g.push(e);for(const e of g)this.g_azF(e);g.length=0}g_ayU(e,a,g){e.setUint16(a,this.g_ayy),a+=2;let _=0;this.g_azj&&(_=1),e.setUint8(a,_),a+=1,e.setUint16(a,this.g_azi),a+=2,e.setUint16(a,this.g_azb),a+=2;for(const _ of this.g_aze)_.g_ayP()&&(a=_.g_ayU(e,a,g));return a}g_azG(e,a){if(this.g_azf.has(e))return void console.warn("OverrideNid passed id "+e+" which is already in use and cannot be overridden");if(this.g_azg.has(a))return void console.warn("OverrideNid passed nid "+a+" which is already in use and cannot be overridden");const g=new p(this,e,a);return this.g_azf.set(e,g),this.g_azg.add(a),this.g_aze.push(g),this.g_azj=!0,g}g_azH(e){const a=this.g_azf.get(e);a&&this.g_azF(a)}g_azI(e){const a=this.g_azm.get(e);a&&this.g_azF(a)}g_ayl(){return{hasOverriddenNids:this.g_azs(),netValues:this.g_azd.map(e=>e.g_ayl()),netInstances:this.g_aze.map(e=>e.g_ayl())}}g_azJ(){return{roId:this.g_ay_,sid:this.g_BB,netValues:this.g_azd.map(e=>e.g_ayl())}}}}{function g(e){if(e)try{e.close()}catch(e){}}function _(e,g,a){return e===g?0:(a-e)/(g-e)}const t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,n=[];class i{constructor(e,a,g){this.g_ayw=e,this.g_aba=a,this.g_ayy=0,this.g_azK=g,this.g_azL=null,this.g_azM=null,this.g_azN=!1,this.g_azO=null,this.g_azP=!1,this.g_azQ=null,this.g_azR=!1,this.g_azS=!1,this.g_azT=!1,this.g_azU=!1,this.g_azV=!1,this.g_azW=0,this.g_azX=0,this.g_azY=0,this.g_azZ=[],this.g_az_=0,this.g_az$=0,this.g_aAa=[],this.g_ayF=null,this.g_ayG=null,this.g_ayH=null,this.g_aAb=0,this.g_aAc=!1,this.g_aAd=1,this.g_aAe=[],this.g_aAf=0,this.g_aAg=0,this.g_ayw.g_aAh(this)}g_ayL(){return this.g_aba}g_ayM(){return this.g_ayy}g_azp(e){this.g_ayy=e}g_aAi(){return this.g_azK}g_arf(){return this===this.g_ayw.g_aAj()}g_aAk(){return this===this.g_ayw.g_aAl()}g_aAm(){return this.g_azZ}g_aAn(e){this.g_az_=e}g_aAo(){return this.g_az_}g_aAp(e){this.g_az$=e}g_aAq(){return this.g_az$}g_aAr(){return this.g_aAf}g_aAs(){return this.g_aAg}g_aAt(e,g){e.binaryType="arraybuffer",e.onopen=()=>{"o"===g?this.g_azN=!0:"r"===g?this.g_azP=!0:"u"==g&&(this.g_azR=!0),this.g_aAu()},e.onmessage=e=>{this.g_aAv(g,e)},e.onerror=e=>{console.error("Peer '"+this.g_aba+"' datachannel '"+g+"' error: ",e),this.g_ayw.g_aAw(this,e),this.g_ayw.g_arf()&&!this.g_arf()&&this.g_lx("network error")},e.onclose=()=>{this.g_lx("disconnect")}}g_aAx(){if(this.g_aAk())return;const e=this.g_ayw.g_arf();this.g_azN=!1,this.g_azP=!1,this.g_azR=!1,this.g_azS=!1,this.g_azT=!1,this.g_azX=performance.now(),this.g_azL=new t({iceServers:this.g_ayw.g_aAy()}),this.g_azL.onicecandidate=e=>{e.candidate&&this.g_ayw.g_aAz({message:"icecandidate",toclientid:this.g_aba,icecandidate:e.candidate})},this.g_azL.onsignalingstatechange=()=>{this.g_azL&&("closed"!==this.g_azL.signalingState||this.g_lx("disconnect"))},this.g_azL.oniceconnectionstatechange=()=>{this.g_azL&&("failed"!==this.g_azL.iceConnectionState&&"closed"!==this.g_azL.iceConnectionState||this.g_lx("disconnect"))};const g=`c2mp_${this.g_ayw.g_aAA()}_${this.g_ayw.g_aAB()}_${this.g_ayw.g_aAC()}`;e?(this.g_ayy=this.g_ayw.g_aAD(),this.g_azM=this.g_azL.createDataChannel("o",{ordered:!0,protocol:g}),this.g_aAt(this.g_azM,"o"),this.g_azO=this.g_azL.createDataChannel("r",{ordered:!1,protocol:g}),this.g_aAt(this.g_azO,"r"),this.g_azQ=this.g_azL.createDataChannel("u",{ordered:!1,g_aAE:0,protocol:g}),this.g_aAt(this.g_azQ,"u"),this.g_azL.createOffer().then(e=>{this.g_azL.setLocalDescription(e),this.g_ayw.g_aAz({message:"offer",toclientid:this.g_aba,offer:e})}).catch(e=>{console.error("Host error creating offer for peer '"+this.g_aba+"': ",e),this.g_ayw.g_aAw(this,"could not create offer for peer")})):this.g_azL.ondatachannel=e=>{if(e.channel.protocol!==g)return console.error("Unexpected datachannel protocol '"+e.channel.protocol+"', should be '"+g_aAF+"'"),void this.g_ayw.g_aAw(this,"unexpected datachannel protocol '"+e.channel.protocol+"', should be '"+g_aAF+"'");const a=e.channel.label;"o"===a?this.g_azM=e.channel:"r"===a?this.g_azO=e.channel:"u"===a?this.g_azQ=e.channel:(console.error("Unknown datachannel label: "+e.channel.label),this.g_ayw.g_aAw(this,"unknown datachannel label '"+e.channel.label+"'")),this.g_aAt(e.channel,a)}}g_aAG(e){this.g_azL&&this.g_azL.addIceCandidate(e)}g_aAH(){return!!this.g_azL}g_aAI(){return this.g_azL}g_aAu(){this.g_azS||this.g_azP&&this.g_azR&&this.g_azN&&(this.g_aAJ(),this.g_azS=!0,this.g_azT=!1)}g_aAJ(){if(this.g_azW=performance.now(),this.g_ayw.g_arf()){this.g_ayw.g_aAK("o",JSON.stringify({c:"j",i:this.g_aba,n:this.g_ayy,a:this.g_azK}),this),this.g_aAL("o",JSON.stringify({c:"hi",hn:this.g_ayw.g_aAj().g_ayM(),n:this.g_ayy,d:this.g_ayw.g_aAM(),u:this.g_ayw.g_aAN(),objs:this.g_ayw.g_aAO(),cvs:this.g_ayw.g_aAP()}));for(const e of this.g_ayw.g_aAQ())!e.g_arf()&&e!==this&&e.g_aAR()&&this.g_aAL("o",JSON.stringify({c:"j",i:e.g_ayL(),n:e.g_ayM(),a:e.g_aAi()}))}else this.g_azV=!0,this.g_arf()&&this.g_aAS(performance.now(),!0);this.g_ayw.g_aqV(this)}g_aAT(e){this.g_azT||!this.g_azS||(this.g_axX(e),this.g_azT=!0,this.g_azS=!1)}g_axX(e){this.g_ayw.g_arf()&&!this.g_aAk()&&this.g_ayw.g_aAK("o",JSON.stringify({c:"l",i:this.g_aba,a:this.g_azK,r:e}),this),this.g_aAk()||this.g_ayw.g_aqX(this,e)}g_aAR(){return this.g_azS&&!this.g_azT}g_aAL(g,a){this.g_ayw.g_aAU();let _=0;a.length?_=a.length:a.byteLength&&(_=a.byteLength),this.g_ayw.g_aAV(_);const t=this.g_ayw.g_aAW(),n=this.g_ayw.g_aAX(),e=this.g_ayw.g_aAY();if(!(0<t&&"u"===g&&Math.random()<t))if(0===n&&0===e)this.g_aAZ(g,a);else{let _=1;"u"!==g&&Math.random()<t&&(_=3),setTimeout(()=>this.g_aAZ(g,a),n*_+Math.random()*e*_)}}g_aAZ(e,a){try{"o"===e?this.g_azN&&this.g_azM&&this.g_azM.send(a):"r"===e?this.g_azP&&this.g_azO&&this.g_azO.send(a):"u"==e&&this.g_azR&&this.g_azQ&&this.g_azQ.send(a)}catch(g){if(this.g_azU)return;this.g_ayw.g_arf()?"o"===e||"r"===e?("string"==typeof a?(console.error("Error sending "+a.length+"-char string on '"+e+"' to '"+this.g_azK+"', host kicking: ",g),console.log("String that failed to send from previous error was: "+a)):console.error("Error sending "+(a.length||a.byteLength)+"-byte binary on '"+e+"' to '"+this.g_azK+"', host kicking: ",g),this.g_lx("network error")):(this.g_azY++,10<=this.g_azY&&("string"==typeof a?(console.error("Too many errors ("+this.g_azY+") sending data on '"+e+"' to '"+this.g_azK+"', kicking; last error was for sending "+a.length+"-char string: ",g),console.log("String that failed to send from previous error was: "+a)):console.error("Too many errors ("+this.g_azY+") sending data on '"+e+"' to '"+this.g_azK+"', kicking; last error was for sending "+(a.length||a.byteLength)+"-byte binary: ",g),this.g_lx("network error"))):console.error("Error sending data on '"+e+"': ",g)}}g_aAS(e,a){return this.g_azU?void 0:!a&&!this.g_aAR()&&this.g_azL&&25e3<e-this.g_azX?(console.warn("Timed out '"+this.g_azK+"', could not establish connection after 25sec"),void this.g_lx("timeout")):!a&&this.g_aAR()&&2e4<e-this.g_azW?(console.warn("Timed out '"+this.g_azK+"', not heard from for 20sec"),void this.g_lx("timeout")):void(this.g_aAb=e,this.g_aAc=!0,this.g_aAd++,this.g_aAL("u","ping:"+this.g_aAd))}g_aA_(e){let a="pong:"+e.substr(5);this.g_ayw.g_arf()&&(a+="/",a+=Math.round(performance.now()).toString()),this.g_aAL("u",a)}g_aA$(_){if(!this.g_aAc)return;const a=_.indexOf(":");if(-1<a){const e=parseFloat(_.substr(a+1));if(e!==this.g_aAd)return}else return void console.warn("Cannot parse off ping ID from pong");const t=performance.now();this.g_aAc=!1;const i=(t-this.g_aAb)/2;this.g_aAe.push(i),10<this.g_aAe.length&&this.g_aAe.shift(),n.push(...this.g_aAe),n.sort((e,g)=>e-g),this.g_aAg=n[n.length-1]-n[0];let e=0,r=n.length;4<=n.length&&6>=n.length?(++e,--r):6<n.length&&(e+=2,r-=2);let o=0;for(let a=e;a<r;++a)o+=n[a];if(this.g_aAf=o/(r-e),n.length=0,!this.g_ayw.g_arf()){const a=_.indexOf("/");if(-1<a){const e=parseFloat(_.substr(a+1));isFinite(e)?this.g_ayw.g_aBa(e,t,i,this.g_aAf):console.warn("Invalid host time from pong response")}else console.warn("Cannot parse off host time from pong response")}}g_aAv(g,a){const _=this.g_ayw.g_aAW(),t=this.g_ayw.g_aAX(),n=this.g_ayw.g_aAY();if(!(0<_&&"u"===g&&Math.random()<_))if(0===t&&0===n)this.g_aBb(g,a);else{let e=1;"u"!==g&&Math.random()<_&&(e=3),setTimeout(()=>this.g_aBb(g,a),t*e+Math.random()*n*e)}}g_aBb(e,g){if(this.g_azU)return;this.g_azW=performance.now(),this.g_ayw.g_aBc();let a=0;if(g.data.length?a=g.data.length:g.data.byteLength&&(a=g.data.byteLength),this.g_ayw.g_aBd(a),"string"==typeof g.data){if(""===g.data.trim()||4>g.data.length)return;const e=g.data.substr(0,4);if("ping"===e)return void this.g_aA_(g.data);if("pong"===e)return void this.g_aA$(g.data);var _;try{_=JSON.parse(g.data)}catch(e){return this.g_ayw.g_aAw(this,e),this.g_ayw.g_arf()?(console.error("Error parsing message as JSON for peer '"+this.g_aba+"', host kicking: ",e),this.g_lx("data error")):console.error("Error parsing message as JSON for peer '"+this.g_aba+"': ",e),void console.log("String that failed to parse from previous error: "+g.data)}if(!_)return;try{_.c&&"m"!==_.c?this.g_aBe(_):this.g_ayw.g_aqW(this,_)}catch(e){this.g_ayw.g_aAw(this,e),this.g_ayw.g_arf()?(console.error("Error handling message for peer '"+this.g_aba+"', host kicking: ",e),this.g_lx("data error")):console.error("Error handling message for peer '"+this.g_aba+"': ",e)}return}!this.g_azV&&this.g_ayw.g_arf()&&"u"===e&&(this.g_azV=!0,this.g_ayw.g_aBf(this.g_aba));try{this.g_aBg(g.data)}catch(e){return this.g_ayw.g_aAw(this,e),void(this.g_ayw.g_arf()?(console.error("Error handling binary update for peer '"+this.g_aba+"', host kicking: ",e),this.g_lx("data error")):console.error("Error handling binary update for peer '"+this.g_aba+"': ",e))}}g_aBe(e){let a,g;switch(e.c){case"disconnect":e.k&&this.g_ayw.g_avM("peer-kicked"),g=!this.g_ayw.g_arf()&&!this.g_arf(),this.g_lx(e.r),g&&this.g_ayw.g_asn();break;case"hi":this.g_ayw.g_arf()||(this.g_ayw.g_aAj().g_azp(e.hn),this.g_ayw.g_aAl().g_azp(e.n),this.g_ayw.g_aBh(e.d),this.g_ayw.g_aBi(e.u),this.g_ayw.g_aBj(e.objs),this.g_ayw.g_aBk(e.cvs));break;case"j":this.g_ayw.g_arf()||(a=new i(this.g_ayw,e.i,e.a),a.g_azp(e.n),this.g_ayw.g_aqV(a));break;case"l":this.g_ayw.g_arf()||(a=this.g_ayw.g_aBl(e.i),a&&(!a.g_aAk()&&this.g_ayw.g_aqX(a,e.r),a.g_lx(e.r)));break;default:console.error("Unknown control message from peer '"+this.g_aba+"': "+e.c),this.g_ayw.g_aAw(this,"unknown control message '"+e.c+"'");}}g_aBg(e){this.g_ayw.g_arf()?this.g_aBm(e):this.g_aBn(e)}g_aBm(g){const _=new DataView(g);let t=0;const a=_.getUint32(t);if(t+=4,1664249200!==a)return void console.warn("Rejected packet with incorrect magic number (received '"+a+"', expected '"+1664249200+"'");let n=_.getFloat64(t);if(t+=8,n+=this.g_aAf,!(3e3<=Math.abs(n-performance.now()))){_.getUint8(t),t+=1;const g=_.getUint8(t);t+=1;const i=[],r=this.g_ayw.g_aBo();for(let n=0;n<g;++n){if(n>=r.length){i.push(0);continue}const e=r[n];let a=0;switch(e.g_aym()){case 0:a=_.getFloat64(t),t+=8;break;case 1:a=_.getFloat32(t),t+=4;break;case 2:a=e.g_ayt(_.getInt16(t)),t+=2;break;case 3:a=e.g_ayt(_.getUint8(t)),t+=1;break;default:a=_.getFloat32(t),t+=4;}i.push(a)}this.g_aBp(n,i)}}g_aBp(e,a){for(let g=0,_=this.g_aAa.length;g<_;++g){const _=this.g_aAa[g];if(_.timestamp===e)return;if(_.timestamp>e)return void this.g_aAa.splice(g,0,new g_ayY(e,a))}this.g_aAa.push(new g_ayY(e,a))}g_Im(e){if(0!==this.g_aAa.length){for(;2<this.g_aAa.length&&this.g_aAa[0]!==this.g_ayF&&this.g_aAa[0]!==this.g_ayG&&this.g_aAa[0]!==this.g_ayH;)this.g_aAa.shift();if(!(this.g_ayH&&this.g_ayH.timestamp>e&&this.g_ayG&&this.g_ayG.timestamp<e)){this.g_ayH=null;for(let a=0,g=this.g_aAa.length;a<g;++a){const g=this.g_aAa[a];if(g.timestamp<=e)(!this.g_ayG||g.timestamp>this.g_ayG.timestamp)&&(this.g_ayF=this.g_ayG,this.g_ayG=g);else{this.g_ayH=g;break}}}}}g_aBn(g){const a=new DataView(g);let _=0;const t=a.getUint32(_);if(_+=4,1664249200!==t)return void console.warn("Rejected packet with incorrect magic number (received '"+t+"', expected '"+1664249200+"'");const n=a.getUint32(_);_+=4,0===n?this.g_aBq(a,_):1===n?this.g_aBr(a,_):console.warn("Ignoring packet with incorrect flags (received "+n+", expected 0 or 1")}g_aBq(_,a){const t=_.getFloat64(a);a+=8;const g=_.getUint16(a);a+=2;for(let n=0;n<g;++n){const n=_.getUint16(a);a+=2;const r=_.getUint8(a);a+=1;let o=null,s=0;const g=this.g_ayw.g_aBs(n);g?(o=g.g_ayz(),s=o.length,1===r&&g.g_azr(!0)):console.warn("Don't know which object corresponds to NID "+n);const e=_.getUint16(a);a+=2;const i=_.getUint16(a);a+=2;for(let n=0;n<e;++n){const n=_.getUint16(a);if(a+=2,g){const r=[];let e=a;for(let a=0;a<s;++a){const g=o[a];let t=0;switch(g.g_aym()){case 0:t=_.getFloat64(e),e+=8;break;case 1:t=_.getFloat32(e),e+=4;break;case 2:t=g.g_ayt(_.getInt16(e)),e+=2;break;case 3:t=g.g_ayt(_.getUint8(e)),e+=1;break;default:t=_.getFloat32(e),e+=4;}r.push(t)}g.g_ayV(t,n,r)}a+=i}}}g_aBr(g,a){const _=g.getFloat64(a);a+=8;const t=g.getUint16(a);a+=2;for(let n=0;n<t;++n){const t=g.getUint16(a);a+=2;const n=this.g_ayw.g_aBs(t);n||console.warn("Don't know which object corresponds to NID "+g_aBt);const e=g.getUint16(a);a+=2;for(let t=0;t<e;++t){const e=g.getUint16(a);a+=2,n&&!n.g_azs()&&(this.g_ayw.g_are(n,e,_),n.g_azI(e))}}}g_lx(a,e){this.g_azU||(this.g_azU=!0,this.g_aAT(a),this.g_aAL("o",JSON.stringify({c:"disconnect",r:a,k:!!e})),g(this.g_azM),g(this.g_azO),g(this.g_azQ),g(this.g_azL),this.g_azM=null,this.g_azO=null,this.g_azQ=null,this.g_azL=null,this.g_azN=!1,this.g_azP=!1,this.g_azR=!1,this.g_ayw.g_aBu(this))}g_aBv(e){return this.g_ayw.g_aBw(e)}g_aBx(e){const a=this.g_ayw.g_aBy(e);if(!a)return 0;const g=a.g_CQ();if(0===this.g_aAa.length)return 0;const _=this.g_aAa[this.g_aAa.length-1].data;return 0>g||g>=_.length?0:_[g]}g_aBz(t){const n=t.g_CQ();if(!this.g_ayH&&!this.g_ayG)return 0;if(this.g_ayH&&!this.g_ayG){const e=this.g_ayH.data;return 0>n||n>=e.length?0:e[n]}const r=this.g_ayw.g_azx();let o,s,d,l,c;if(!this.g_ayH&&this.g_ayG)if(this.g_ayF){o=this.g_ayF.timestamp,s=this.g_ayF.data[n],d=this.g_ayG.timestamp,l=this.g_ayG.data[n];let e=r;return e>this.g_ayG.timestamp+250&&(e=this.g_ayG.timestamp+250),c=_(o,d,e),g_ayX.g_ayu(this.g_ayw.g_aBo()[n].g_arX(),s,l,c,!0)}else{const e=this.g_ayG.data;return 0>n||n>=e.length?0:e[n]}return o=this.g_ayG.timestamp,s=this.g_ayG.data[n],d=this.g_ayH.timestamp,l=this.g_ayH.data[n],c=_(o,d,r),g_ayX.g_ayu(this.g_ayw.g_aBo()[n].g_arX(),s,l,c,!1)}}self.g_aBA=i}{const _=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,t=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription,n=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate||window.msRTCIceCandidate,a=window.RTCDataChannel||window.webkitRTCDataChannel||window.mozRTCDataChannel||window.msRTCDataChannel,i=[{urls:"stun:stun.l.google.com:19302"}];let e=!1;const r=[],g=class extends g_avH{constructor(e){super(e,"multiplayer"),this.g_aBB=[],this.g_aBC=null,this.g_aBD=!1,this.g_aBE=!1,this.g_apZ={g_aBF:0,version:0,name:"",operator:"",g_aBG:""},this.g_aqc="",this.g_aqd="",this.g_aqh="",this.g_aqi="",this.g_aqj="",this.g_aqn=[],this.g_aqo=new Map,this.g_aBH=0,this.g_aBI=new Set,this.g_aBJ=null,this.g_aBK=null,this.g_aqH=80,this.g_aBL=30,this.g_aBM=30,this.g_aBN=0,this.g_aBO={g_aBP:0,g_aBQ:0,g_aBR:0,g_aBS:0,g_aBT:0,g_aBU:0,g_aBV:0,g_aBW:0,g_aBX:0},this.g_aBY=new ArrayBuffer(262144),this.g_aBZ=new DataView(this.g_aBY),this.g_aB_=[],this.g_aB$=1,this.g_aCa=new Map,this.g_aCb=new Map,this.g_aCc=0,this.g_aCd=0,this.g_aCe=0,this.g_aCf=[],this.g_aCg=0,this.g_aCh=0,this.g_aCi=this.g_aqH,this.g_aCj=this.g_aqH,this.g_aCk=[],this.g_aCl=new Map,this.g_aCm=!1,this.g_aCn(i),setInterval(()=>this.g_aCo(),2e3),window.addEventListener("unload",()=>this.g_aCp("quit")),this.g_avT("get-supported",()=>this.g_aCq()),this.g_avT("add-ice-servers",e=>this.g_aCn(e.list)),this.g_avT("simulate-latency",e=>this.g_aCr(e.latency,e.pdv,e.loss)),this.g_avT("set-bandwidth-profile",e=>this.g_aCs(e.updateRate,e.delay)),this.g_avT("tick",e=>this.g_Im(e)),this.g_avT("alert",e=>this.g_apc(e)),this.g_avT("signalling-connect",e=>this.g_ash(e.url)),this.g_avT("signalling-disconnect",()=>this.g_asi()),this.g_avT("signalling-login",e=>this.g_ask(e.alias)),this.g_avT("signalling-join-room",e=>this.g_aCt(e.game,e.instance,e.room,e.maxClients)),this.g_avT("signalling-auto-join-room",e=>this.g_aCu(e.game,e.instance,e.room,e.maxClients,e.lock)),this.g_avT("signalling-leave-room",()=>this.g_asn()),this.g_avT("signalling-list-game-instances",e=>this.g_asy(e.game)),this.g_avT("signalling-list-rooms",e=>this.g_asz(e.game,e.instance,e.which)),this.g_avT("disconnect-room",()=>this.g_aso(!0)),this.g_avT("peer-send-message",e=>this.g_aCv(e)),this.g_avT("host-broadcast",e=>this.g_aCw(e)),this.g_avT("kick-peer",e=>this.g_aCx(e)),this.g_avT("sync-object",e=>this.g_aCy(e)),this.g_avT("sync-inst-var",e=>this.g_aCz(e)),this.g_avT("associate-object",e=>this.g_aCA(e)),this.g_avT("remove-object-id",e=>this.g_azH(e.uid)),this.g_avT("remove-net-insts",e=>this.g_aCB(e)),this.g_avT("remove-object-nid",e=>this.g_aCC(e)),this.g_avT("set-client-state",e=>this.g_asv(e.tag,e.value)),this.g_avT("add-client-input-value",e=>this.g_asw(e.tag,e.precision,e.interp))}g_aCD(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.details?e.details:"string"==typeof e.data?e.data:"string"==typeof e.type?e.type:"unknown error":"unknown error"}g_aCE(){return this.g_aBD}g_aCF(){return this.g_aCE()&&this.g_aBE}g_arg(){return this.g_aCF()&&this.g_aqj}g_arf(){return this.g_arg()&&this.g_aBJ&&this.g_aBK===this.g_aBJ}g_aCG(){return this.g_aCF()?this.g_aqc:""}g_aCH(){return this.g_aCF()?this.g_aqd:""}g_aAA(){return this.g_aCF()?this.g_aqh:""}g_aAB(){return this.g_aCF()?this.g_aqi:""}g_aAC(){return this.g_arg()?this.g_aqj:""}g_aCI(){return this.g_aBK?this.g_aBK.g_ayL():""}g_aCJ(){return this.g_aBK?this.g_aBK.g_aAi():""}g_aAj(){return this.g_aBK}g_aAl(){return this.g_aBJ}g_aCr(e,a,g){var _=Math.max;this.g_aCc=_(e,0),this.g_aCd=_(a,0),this.g_aCe=_(g,0)}g_aAW(){return this.g_aCe}g_aAX(){return this.g_aCc}g_aAY(){return this.g_aCd}g_aCq(){return{isSupported:!!(_&&a)}}g_ash(e){if(!(this.g_aBC||this.g_aBD)){try{this.g_aBC=new WebSocket(e,"c2multiplayer")}catch(e){return this.g_aBC=null,void this.g_aqM(e)}this.g_aBC.onopen=()=>-1===this.g_aBC.protocol.indexOf("c2multiplayer")?(this.g_aqM("server does not support 'c2multiplayer' protocol"),this.g_aBC.close(1002,"'c2multiplayer' protocol required"),this.g_aBC=null,void(this.g_aBD=!1)):void(this.g_aBD=!0),this.g_aBC.onclose=()=>{this.g_aqN(),this.g_aBD=!1,this.g_aBE=!1,this.g_aBC=null},this.g_aBC.onerror=e=>{console.error("Signalling server error: ",e),this.g_aqM(e)},this.g_aBC.onmessage=e=>{this.g_aCK(e)}}}g_asi(){this.g_aBC&&this.g_aBD&&(this.g_aBC.close(),this.g_aBC=null,this.g_aBD=!1)}g_aCK(e){let a;try{a=JSON.parse(e.data)}catch(e){return void this.g_aqM(e)}switch(a.message){case"welcome":this.g_aCL(a);break;case"login-ok":this.g_aCM(a);break;case"join-ok":this.g_aCN(a);break;case"leave-ok":this.g_aCO(a);break;case"kicked":this.g_aCP(a);break;case"peer-joined":this.g_aCQ(a);break;case"peer-quit":this.g_aCR(a);break;case"icecandidate":this.g_aCS(a);break;case"offer":this.g_aCT(a);break;case"answer":this.g_aCU(a);break;case"instance-list":this.g_aCV(a);break;case"room-list":this.g_aCW(a);break;case"error":this.g_aqM(a.details);break;default:this.g_aqM("received unknown signalling message");}}g_aCX(e){for(const a of this.g_aBB)if(a.urls===e.urls)return!0;return!1}g_aCn(e){if(e)for(let a of e)"string"==typeof a&&(a={urls:a}),this.g_aCX(a)||(!a.hasOwnProperty("url")&&(a.url=a.urls),this.g_aBB.push(a))}g_aAy(){return this.g_aBB}g_aqM(e){this.g_avM("signalling-error",{message:this.g_aCD(e)})}g_aqN(){this.g_avM("signalling-close")}g_aCL(e){if(1>e.protocolrev||1<e.protocolrev)return this.g_aqM("signalling server protocol revision not supported"),void this.g_asi();this.g_aqc=e.clientid;const a=this.g_apZ;a.g_aBF=e.protocolrev,a.version=e.version,a.name=e.name,a.operator=e.operator,a.g_aBG=e.motd,this.g_aCn(e.ice_servers),this.g_avM("signalling-welcome",{myid:this.g_aqc,sigservinfo:{protocolrev:a.g_aBF,version:a.version,name:a.name,operator:a.operator,motd:a.g_aBG}})}g_aCM(e){this.g_aqd=e.alias,this.g_aBE=!0,this.g_avM("signalling-login-ok",{myalias:this.g_aqd})}g_ay$(){return this.g_aB$++}g_aAD(){if(this.g_arf()){do this.g_aBH++,65535<this.g_aBH&&(this.g_aBH=0);while(this.g_aBI.has(this.g_aBH));const e=this.g_aBH;return this.g_aBI.add(e),e}}g_aCY(e){this.g_arf()&&this.g_aBI.delete(e)}g_aCN(e){this.g_aCp("disconnect"),this.g_aqh=e.game,this.g_aqi=e.instance,this.g_aqj=e.room,this.g_aBJ=new g_aBA(this,this.g_aqc,this.g_aqd),e.host?(this.g_aBK=this.g_aBJ,this.g_aBH=0,this.g_aBI.clear(),this.g_aBK.g_azp(this.g_aAD())):(this.g_aCf.length=0,this.g_aCg=0,this.g_aCh=0,this.g_aqH=80,this.g_aBL=30,this.g_aBM=30,this.g_aCi=this.g_aqH,this.g_aCj=this.g_aqH,this.g_aBK=new g_aBA(this,e.hostid,e.hostalias),this.g_aBK.g_aAx()),this.g_avM("signalling-join-ok",{isHost:!!e.host,hostId:this.g_aBK.g_ayL(),hostAlias:this.g_aBK.g_aAi(),game:this.g_aqh,gameInstance:this.g_aqi,room:this.g_aqj})}g_aCO(){this.g_aqj="",this.g_avM("signalling-leave-ok")}g_aCP(){this.g_aso(),this.g_aqj="",this.g_avM("signalling-kicked")}g_aCQ(e){if(this.g_aBE&&this.g_aqj&&this.g_arf()){const a=this.g_aqo.get(e.peerid);a&&a.g_lx("rejoin");const g=new g_aBA(this,e.peerid,e.peeralias);g.g_aAx()}}g_aCR(e){if(this.g_aBE&&this.g_aqj&&this.g_arf()){const a=this.g_aqo.get(e.id);a&&a.g_lx(e.reason)}}g_aCS(e){if(this.g_aBE&&this.g_aqj){const a=this.g_aqo.get(e.from);a&&a.g_aAG(new n(e.icecandidate))}}g_aCT(e){if(!this.g_aBE||!this.g_aqj||this.g_arf()||!this.g_aBJ||!this.g_aBK||!this.g_aBK.g_aAH())return;if(e.from!==this.g_aBK.g_ayL())return;const g=this.g_aBK.g_aAI();g.setRemoteDescription(new t(e.offer)).then(()=>{g.createAnswer().then(e=>{g.setLocalDescription(e),this.g_aAz({message:"answer",toclientid:this.g_aBK.g_ayL(),answer:e})}).catch(e=>{console.error("Peer error creating answer: ",e),this.g_aAw(this.g_aBJ,"could not create answer to host offer")})}).catch(e=>{console.error("Peer error setting remote description: ",e),this.g_aAw(this.g_aBJ,"could not set remote description")})}g_aCU(e){if(this.g_aBE&&this.g_aqj&&this.g_arf()){const a=this.g_aqo.get(e.from);a&&a.g_aAI().setRemoteDescription(new t(e.answer)).catch(e=>{console.error("Host error setting remote description: ",e)})}}g_aCV(e){this.g_avM("signalling-instance-list",{list:e.list})}g_aCW(e){this.g_avM("signalling-room-list",{list:e.list})}g_aAz(e){this.g_aBC&&this.g_aBD&&this.g_aBC.send(JSON.stringify(e))}g_ask(e){this.g_aBE||this.g_aAz({message:"login",protocolrev:1,alias:e})}g_aCt(e,a,g,_){!this.g_aBE||this.g_aqj||this.g_aAz({message:"join",game:e,instance:a,room:g,max_clients:_})}g_aCu(g,a,_,t,n){!this.g_aBE||this.g_aqj||this.g_aAz({message:"auto-join",game:g,instance:a,room:_,max_clients:t,lock_when_full:n})}g_asn(){this.g_aBE&&this.g_aAz({message:"leave"})}g_aBf(e){this.g_aBE&&this.g_arf()&&this.g_aAz({message:"confirm-peer",id:e})}g_asy(e){this.g_aBC&&this.g_aBD&&this.g_aAz({message:"list-instances",game:e})}g_asz(e,a,g){this.g_aBC&&this.g_aBD&&this.g_aAz({message:"list-rooms",game:e,instance:a,which:g})}g_aso(e){this.g_aCf.length=0,this.g_aCg=0,this.g_aCh=0,this.g_aCp("disconnect"),e&&this.g_asn()}g_aAh(e){this.g_aqn.push(e),this.g_aqo.set(e.g_ayL(),e),this.g_avM("add-peer",{id:e.g_ayL(),alias:e.g_aAi()})}g_aBu(e){this.g_avM("remove-peer",{id:e.g_ayL()}),this.g_arf()&&this.g_aCY(e.g_ayM());const a=this.g_aqn.indexOf(e);-1<a&&this.g_aqn.splice(a,1),this.g_aqo.delete(e.g_ayL()),this.g_aBK===e&&(this.g_aBK=null,this.g_aCp("host quit")),this.g_aBJ===e&&(this.g_aBJ=null,this.g_aqj="",this.g_aCp("disconnect"))}g_aCp(g){if(!e){for(e=!0;this.g_aqn.length;)this.g_aqn[0].g_lx(g);e=!1}}g_aBl(e){return this.g_aqo.get(e)||null}g_aCZ(e){const a=this.g_aqo.get(e);return a?a.g_aAi():""}g_aC_(e){for(const a of this.g_aqn)if(a.g_ayM()===e)return a;return null}g_aCw(g){const a=g.fromId,_=g.tag,t=g.message,n=g.mode,e=this.g_aBl(a);this.g_aAK(n,JSON.stringify({c:"m",t:_,f:a,m:t}),e)}g_aAK(g,a,_){if(this.g_arf()){const t=this.g_aqn.slice(0);for(const n of t)n&&n!==this.g_aBJ&&n!==_&&n.g_aAL(g,a)}}g_aCo(){const e=performance.now();if(this.g_arf()){r.push(...this.g_aqn);for(const a of r)a&&a!==this.g_aBJ&&a.g_aAS(e,!1);r.length=0}else this.g_aBK&&this.g_aBK.g_aAS(e,!1)}g_azn(e){this.g_aB_.push(e),this.g_aCb.set(e.g_azo(),e),this.g_aCa.set(e.g_ayM(),e)}g_aAO(){const e={};for(const[a,g]of this.g_aCa.entries())e[g.g_azt()]={nid:a,nvs:g.g_azB()};return e}g_aBj(e){this.g_aCa.clear();for(const a of this.g_aB_)if(e.hasOwnProperty(a.g_azt().toString())){const g=e[a.g_azt().toString()];a.g_azp(g.nid),this.g_aCa.set(g.nid,a),a.g_azC(g.nvs)}else console.warn("Could not map object SID '"+a.g_azt()+"' - host did not send NID for it"),a.g_azp(-1)}g_aBs(e){return this.g_aCa.get(e)||null}g_Im(g){if(!this.g_arg())return null;const a=g.dt,_=performance.now(),t=this.g_arf()?this.g_aBL:this.g_aBM;_-this.g_aBN>=1e3/t-5&&(this.g_aC$(_),this.g_aBN=_);const n=this.g_aBO;1e3<=_-n.g_aBP&&(n.g_aBQ=n.g_aBR,n.g_aBS=n.g_aBT,n.g_aBU=n.g_aBV,n.g_aBW=n.g_aBX,n.g_aBR=0,n.g_aBT=0,n.g_aBV=0,n.g_aBX=0,n.g_aBP+=1e3,500<_-n.g_aBP&&(n.g_aBP=_),this.g_avM("stats",{stats:{outboundPerSec:n.g_aBQ,outboundBandwidthPerSec:n.g_aBS,inboundPerSec:n.g_aBU,inboundBandwidthPerSec:n.g_aBW}})),this.g_arf()||(this.g_aCh<this.g_aCg?(this.g_aCh+=10*a,this.g_aCh>this.g_aCg&&(this.g_aCh=this.g_aCg)):this.g_aCh>this.g_aCg&&(this.g_aCh-=10*a,this.g_aCh<this.g_aCg&&(this.g_aCh=this.g_aCg)),this.g_aCj<this.g_aCi?(this.g_aCj+=30*a,this.g_aCj>this.g_aCi&&(this.g_aCj=this.g_aCi)):this.g_aCj>this.g_aCi&&(this.g_aCj-=30*a,this.g_aCj<this.g_aCi&&(this.g_aCj=this.g_aCi)));const e=this.g_azx();for(const a of this.g_aqn)a.g_Im(e);for(const a of this.g_aB_)a.g_Im();return{simulationTime:this.g_azx(),hostInputArrivalTime:this.g_aDa(),clientDelay:this.g_aqH,peerData:this.g_aDb(),roData:this.g_aDc(),isReadyForInput:this.g_ase()}}g_aDb(){const e={};for(const g of this.g_aqn){const _={};for(const e of this.g_aCk)_[e.g_ayn()]=g.g_aBz(e);e[g.g_ayL()]={nid:g.g_ayM(),latency:g.g_aAr(),pdv:g.g_aAs(),clientState:_}}return e}g_aDc(){const e={};for(const a of this.g_aB_)e[a.g_azo()]=a.g_ayl();return e}async g_aC$(e){this.g_arf()?(await this.g_aDd(e),this.g_aDe(e)):await this.g_aDf(e)}async g_ara(){const e=await this.g_avO("before-client-update");for(const a of e.clientStateUpdates)this.g_asv(a.tag,a.value)}async g_aDf(_){if(this.g_ase()&&(await this.g_ara()),!this.g_aBJ||!this.g_aCm)return;const t=this.g_aBZ;let n=0;const i=this.g_aCk,r=this.g_aBJ.g_aAm(),a=_-this.g_aBJ.g_aAo(),e=_-this.g_aBJ.g_aAq();let g=!1;if(g=!!(100>a)||(1e3>a?95<=e:495<=e),!!g){t.setUint32(n,1664249200),n+=4,t.setFloat64(n,_+this.g_aCh),n+=8,t.setUint8(n,0),n+=1,t.setUint8(n,i.length),n+=1;for(let e=0,a=i.length;e<a;++e){const a=i[e];let _=0;e<r.length&&(_=a.g_ayr(r[e])),n=a.g_ays(t,n,_)}this.g_aBJ.g_aAp(_),this.g_aBK.g_aAL("u",new Uint8Array(this.g_aBY,0,n))}}async g_aDd(g){const a=this.g_aBZ;let _=0,t=0;const n=await this.g_avO("get-object-info",{ros:this.g_aB_.map(e=>e.g_azJ())});for(const a of this.g_aB_){const e=a.g_azo();if(!n.hasOwnProperty(e))continue;const _=n[e];a.g_ayQ(_,g),0<a.g_azq()&&t++}if(0!=t){a.setUint32(_,1664249200),_+=4,a.setUint32(_,0),_+=4,a.setFloat64(_,g),_+=8,a.setUint16(_,t),_+=2;for(const e of this.g_aB_)0<e.g_azq()&&(_=e.g_ayU(a,_,g));this.g_aAK("u",new Uint8Array(this.g_aBY,0,_),null)}}g_aDe(e){const g=this.g_aBZ;let _=0,a=0;for(const g of this.g_aB_)g.g_azu().length&&a++;if(0!=a){g.setUint32(_,1664249200),_+=4,g.setUint32(_,1),_+=4,g.setFloat64(_,e),_+=8,g.setUint16(_,a),_+=2;for(const e of this.g_aB_){const t=e.g_azu();if(t.length){g.setUint16(_,e.g_ayM()),_+=2,g.setUint16(_,t.length),_+=2;for(const e of t)g.setUint16(_,e),_+=2;t.length=0}}this.g_aAK("r",new Uint8Array(this.g_aBY,0,_),null)}}g_aBa(g,a,_,t){if(this.g_arf())return;this.g_aCi=t+this.g_aqH;var n=g+_-a;0===this.g_aCf.length&&(this.g_aCh=n,this.g_aCj=this.g_aCi),this.g_aCf.push(n),30<this.g_aCf.length&&this.g_aCf.shift(),r.push(...this.g_aCf),r.sort((e,g)=>e-g);let i=0,o=r.length;4<=r.length&&6>=r.length?(++i,--o):6<r.length&&19>=r.length?(i+=2,o-=2):19<r.length&&(i+=5,o-=5);let s=0;for(let n=i;n<o;++n)s+=r[n];this.g_aCg=s/(o-i),r.length=0}g_azx(){return this.g_arf()?performance.now()-this.g_aqH:performance.now()+this.g_aCh-this.g_aCj}g_aDg(){return this.g_arf()?performance.now():performance.now()+this.g_aCh}g_aDa(){return this.g_arf()?performance.now():performance.now()+this.g_aCh+this.g_aCj}g_asv(e,g){if(!this.g_arf()&&this.g_aBJ&&this.g_aCm){const _=this.g_aCl.get(e);if(_){const e=_.g_CQ(),a=this.g_aBJ.g_aAm();a.length<e+1&&(a.length=e+1),a[e]!==g&&(a[e]=g,this.g_aBJ.g_aAn(performance.now()))}}}g_asw(e,a,g){const _=new g_ayX(this.g_aCk.length,g,a,e,null);this.g_aCl.set(e,_),this.g_aCk.push(_)}g_aBo(){return this.g_aCk}g_aAP(){const e=[];for(const a of this.g_aCk)e.push({tag:a.g_ayn(),precision:a.g_aym(),interp:a.g_arX()});return e}g_aBk(e){this.g_aCl.clear(),this.g_aCk.length=0;for(let a=0,g=e.length;a<g;++a){const g=e[a],_=new g_ayX(a,g.interp,g.precision,g.tag,null);this.g_aCl.set(_.g_ayn(),_),this.g_aCk.push(_)}this.g_aCm=!0}g_azH(e){for(const a of this.g_aB_)a.g_azH(e)}g_aAQ(){return this.g_aqn}g_aDh(){return this.g_arg()?this.g_aqn.length:0}g_aDi(e){return e=Math.floor(e),!this.g_arg()||0>e||e>=this.g_aqn.length?null:this.g_aqn[e]}g_ase(){return!!this.g_arg()&&(!!this.g_arf()||0!==this.g_aCg)}g_aCs(e,a){this.g_arg()||(this.g_aBL=e,this.g_aBM=e,this.g_aqH=a)}g_aqV(e){this.g_avM("peer-open",{id:e.g_ayL(),alias:e.g_aAi()})}g_aCv(g){const a=g.id,_=g.tag,t=g.message,n=g.mode,e=this.g_aBl(a);e&&e.g_aAL(n,JSON.stringify({c:"m",t:_,m:t}))}g_aqX(e,a){this.g_avM("peer-close",{id:e.g_ayL(),alias:e.g_aAi(),reason:a||"unknown"})}g_aAw(e,a){console.error(`[Multiplayer] Peer '${e.g_aAi()}' (${e.g_ayL()}) error: `,a)}g_aqW(e,a){const g=a.f||e.g_ayL();this.g_avM("peer-message",{tag:a.t,fromId:g,fromAlias:this.g_aCZ(g),content:a.m})}g_are(e,a,g){this.g_avM("instance-destroyed",{roId:e.g_azo(),nid:a,timestamp:g})}g_aCx(e){if(this.g_arf()){const a=e.id,g=e.reason,_=this.g_aBl(a);_&&_.g_lx(g,!0)}}g_aAU(){this.g_aBO.g_aBR++}g_aAV(e){this.g_aBO.g_aBT+=e}g_aBc(){this.g_aBO.g_aBV++}g_aBd(e){this.g_aBO.g_aBX+=e}g_aBh(e){this.g_aqH=e}g_aAM(){return this.g_aqH}g_aBi(e){this.g_aBM=e}g_aAN(){return this.g_aBM}g_aCy(g){const _=g.data,t=g.precision,n=g.bandwidth;for(const i of g.objectClasses){const e=new g_ayZ(this,i.roId,i.sid,n);1===_?(e.g_azv(1,t,"x"),e.g_azv(1,t,"y")):2===_?e.g_azv(2,t,"a"):3===_&&(e.g_azv(1,t,"x"),e.g_azv(1,t,"y"),e.g_azv(2,t,"a"))}}g_apc(e){alert(e.message)}g_aCz(g){const _=g.precision,t=g.interp,n=g.cvt;for(const i of g.syncData){const e=this.g_aCb.get(i.roId);e.g_azv(t,_,"iv",i.varIndex,n)}}g_aCA(g){const a=g.roId,_=g.peerId,t=g.instUid,n=this.g_aCb.get(a),e=this.g_aqo.get(_);n&&e&&(!this.g_arf()||n.g_azG(t,e.g_ayM()))}g_aCB(e){for(const[g,_]of Object.entries(e)){const e=this.g_aCb.get(g);if(e)for(const a of _)e.g_azI(a)}}g_aCC(e){const a=e.roId,g=e.nid,_=this.g_aCb.get(a);_&&_.g_azI(g)}};g_awp.g_axe(g)}